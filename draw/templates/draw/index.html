{% load static %}

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>P4 Drawing</title>

    <link rel="stylesheet" type="text/css" href="{% static 'draw/vendor/bootstrap/css/bootstrap.min.css' %}">
    <script type="text/javascript" src="{% static 'draw/vendor/jquery/jquery-3.3.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'draw/vendor/paper/paper-full.min.js' %}"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/alexgibson/shake.js/master/shake.js"></script>

    <style type="text/css">
    </style>

</head>
<style>
  #myCanvas {
    border-style: solid;
  }  
</style>
<body>
    <!-- You may change the dimensions of this canvas -->
    <canvas id="myCanvas" width="750px" height="750px"></canvas>
</body>
<script>

    // setting up the canvas and one paper tool
    var canvas = document.getElementById('myCanvas');
    paper.setup(canvas);
    var tool = new paper.Tool();

    // getting the URL (you may want to use for Exercise 3)
    var url = window.location.href;
  
    // begin changes
    // create a new websocket connecting to the server
    var socket = new WebSocket('ws://p4-ayushsm-ayushsm511991.codeanyapp.com:8765/');
    var path = new paper.Path();
    var colors = ["AliceBlue","AntiqueWhite","Aqua","Aquamarine","Azure","Beige","Bisque","Black","BlanchedAlmond","Blue","BlueViolet","Brown","BurlyWood","CadetBlue","Chartreuse","Chocolate","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","DarkBlue","DarkCyan","DarkGoldenRod","DarkGray","DarkGrey","DarkGreen","DarkKhaki","DarkMagenta","DarkOliveGreen","Darkorange","DarkOrchid","DarkRed","DarkSalmon","DarkSeaGreen","DarkSlateBlue","DarkSlateGray","DarkSlateGrey","DarkTurquoise","DarkViolet","DeepPink","DeepSkyBlue","DimGray","DimGrey","DodgerBlue","FireBrick","FloralWhite","ForestGreen","Fuchsia","Gainsboro","GhostWhite","Gold","GoldenRod","Gray","Grey","Green","GreenYellow","HoneyDew","HotPink","IndianRed","Indigo","Ivory","Khaki","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenRodYellow","LightGray","LightGrey","LightGreen","LightPink","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSlateGrey","LightSteelBlue","LightYellow","Lime","LimeGreen","Linen","Magenta","Maroon","MediumAquaMarine","MediumBlue","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MidnightBlue","MintCream","MistyRose","Moccasin","NavajoWhite","Navy","OldLace","Olive","OliveDrab","Orange","OrangeRed","Orchid","PaleGoldenRod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","Pink","Plum","PowderBlue","Purple","Red","RosyBrown","RoyalBlue","SaddleBrown","Salmon","SandyBrown","SeaGreen","SeaShell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","SlateGrey","Snow","SpringGreen","SteelBlue","Tan","Teal","Thistle","Tomato","Turquoise","Violet","Wheat","White","WhiteSmoke","Yellow","YellowGreen"];
    var color = colors[Math.floor(Math.random() * (colors.length))];
    var prev = {};
    tool.onMouseMove = function(event) { 
      var msg = {
        id: String(color),
        color: color,
        point: event.point
      };
      if (url == "http://p4-ayushsm-ayushsm511991.codeanyapp.com:8000/draw/?size=small" || url == "http://p4-ayushsm-ayushsm511991.codeanyapp.com:8000/draw/") {
        socket.send(JSON.stringify(msg));
      }
    };
  
    // getting the URL (you may want to use for Exercise 3)
    socket.onmessage = function(receivedMessage) {
      var msg = JSON.parse(receivedMessage.data);
      if ((msg.color in prev) === false) {
        prev[msg.color] = new paper.Path();
        prev[msg.color].strokeColor = msg.color;
      }
      path = prev[msg.color].add(new paper.Point(msg.point[1], msg.point[2]));
      if (url == "http://p4-ayushsm-ayushsm511991.codeanyapp.com:8000/draw/?size=small" && color != msg.color) {
        prev[msg.color].visible = false;
      }
    };
  
    socket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };
  
  /*
    var colors = ["red", "darkblue", "green", "black", "gold"];
    var color = colors[Math.floor(Math.random() * colors.length)];
    var prevcolors = [];
    tool.onMouseMove = function(event) {
        console.log(event.on);
        var msg = {
            color: color,
            point: event.point
        };
        socket.send(JSON.stringify(msg));
    }
    
//     var path1 = new paper.Path();
//     path1.strokeColor = 'black';
    socket.onmessage = function(receivedMessage) {
//         path1.add(receivedMessage.data);
        path.strokeColor = JSON.parse(receivedMessage.data).color;
        if (!((receivedMessage.data).color in prevcolors)) {
          prevcolors[(receivedMessage.data).color] = new paper.Path();
          prevcolors[(receivedMessage.data).color].strokeColor = (receivedMessage.data).color;
        }
        prevcolors[(receivedMessage.data).color].add(new paper.Point(JSON.parse(receivedMessage.data).point[1], JSON.parse(receivedMessage.data).point[2]));
        path = prevcolors[(receivedMessage.data).color];
//        path.add(new paper.Point(JSON.parse(receivedMessage.data).point[1], JSON.parse(receivedMessage.data).point[2]));
//         console.log(JSON.parse(receivedMessage.data));
        
    };
    

    // end changes
    */

</script>
</html>